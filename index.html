<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Regolamento â€” Skillboll Survivor Train</title>
  <meta name="description" content="Regolamento ufficiale Skillboll Survivor Train â€” stagione 2025/2026." />
  <link rel="stylesheet" href="style.css?v=20260105" />
</head>

<body>
  <div id="top" aria-hidden="true"></div>
  <div class="bg-fixed" aria-hidden="true"></div>

  <header class="topbar" id="site-top">
    <div class="brand">
      <a class="topbtn" href="./" id="nav-regolamento"><span class="icon-train" aria-hidden="true">ğŸš†</span><span class="btn-label">Regolamento Survivor Train</span></a>
      <a class="topbtn" href="?view=andata&v=20260108" id="nav-andata">Classifica Edizione Andata</a>
      <a class="topbtn" href="?view=ritorno&v=20260108" id="nav-ritorno">Classifica Edizione Ritorno</a>
    </div>

  </header>

  <main class="wrap">
    <section class="section" id="regolamento">
      <h1>ğŸ“œ Regolamento ufficiale</h1>
      <p>
        Questo regolamento disciplina lo <strong>Skillboll Survivor Train</strong> per la stagione 2025/2026. Ãˆ il riferimento valido per tutta lâ€™edizione.
      </p>

      <div class="toc">
        <h2 class="toc-title">Indice</h2>
        <ol class="toc-list">
          <li><a href="#art1">Art. 1 â€” Cosâ€™Ã¨ lo Skillboll Survivor Train</a></li>
          <li><a href="#art2">Art. 2 â€” Struttura delle edizioni</a></li>
          <li><a href="#art3">Art. 3 â€” Le vite</a></li>
          <li><a href="#art4">Art. 4 â€” Quote di iscrizione e rientri</a></li>
          <li><a href="#art5">Art. 5 â€” Bonus Inviti â€“ Vita Extra</a></li>
          <li><a href="#art6">Art. 6 â€” ModalitÃ  di gioco</a></li>
          <li><a href="#art7">Art. 7 â€” Scadenze e giocate automatiche</a></li>
          <li><a href="#art8">Art. 8 â€” Esiti delle partite</a></li>
          <li><a href="#art9">Art. 9 â€” Partite rinviate o sospese</a></li>
          <li><a href="#art10">Art. 10 â€” Classifica ufficiale</a></li>
          <li><a href="#art11">Art. 11 â€” Montepremi garantito e premi speciali</a></li>
          <li><a href="#art12">Art. 12 â€” Spirito del gioco</a></li>
          <li><a href="#art13">Art. 13 â€” Comunicazioni ufficiali</a></li>
          <li><a href="#art14">Art. 14 â€” Amministrazione e Referee</a></li>
        </ol>
      </div>

      <hr class="sep" />

      <!-- ART. 1 -->
      <h2 id="art1">Art. 1 â€” ğŸ¯ Cosâ€™Ã¨ lo Skillboll Survivor Train</h2>
      <p>
        Lo Skillboll Survivor Train Ã¨ una competizione sportiva basata sui pronostici delle partite di Serie A, in cui ogni concorrente
        dispone di una o piÃ¹ vite e deve sopravvivere il piÃ¹ a lungo possibile pronosticando correttamente le squadre vincenti.
        Ogni vittoria fa guadagnare un punteggio variabile stabilito dallâ€™app Skillboll.
      </p>
      <p>
        I punti assegnati a ciascuna squadra sono <strong>visibili e consultabili prima</strong> di effettuare la giocata,
        cosÃ¬ che ogni concorrente possa valutare difficoltÃ  e rischio della scelta.
      </p>
      <p><strong>Obiettivo:</strong> resistere piÃ¹ a lungo possibile e totalizzare piÃ¹ punti degli altri concorrenti.</p>

      <!-- ART. 2 -->
      <h2 id="art2">Art. 2 â€” ğŸ“† Struttura delle edizioni</h2>
      <p>
        Ogni stagione calcistica di Serie A corrisponde a unâ€™edizione completa dello Skillboll Survivor Train, suddivisa in due competizioni distinte,
        entrambe basate sullâ€™accumulo di punti ottenuti attraverso le vite giocate.
      </p>

      <details>
        <summary>â–¶ï¸ A) Edizione dâ€™andata</summary>
        <ul class="bullets">
          <li><span class="icon">â–¶ï¸</span><span class="li-text">Inizia con la <strong class="nowrap">1Âª giornata di Serie A</strong>.</span></li>
          <li><span class="icon">ğŸ“Š</span> Ogni giornata assegna punti in base alle vite giocate e alle vittorie ottenute.</li>
          <li><span class="icon">â›”</span> La competizione termina quando rimane un solo concorrente con almeno una vita attiva, oppure quando tutti i concorrenti perdono tutte le vite disponibili.</li>
          <li><span class="icon">ğŸ†</span> Vince il giocatore con il punteggio piÃ¹ alto tra gli ultimi superstiti (in caso di eliminazione collettiva prevale chi ha totalizzato piÃ¹ punti complessivi fino a quel momento).</li>
        </ul>
        <p class="note">
          ğŸ‘‰ In caso di paritÃ  di punti nelle posizioni a premio, i montepremi dei classificati coinvolti vengono sommati e divisi in parti uguali tra i giocatori a pari punteggio.
          ğŸ‘‰ Nel girone dâ€™andata non si applica lo spareggio basato sulle vite potenziali.
        </p>
      </details>

      <details>
        <summary>â–¶ï¸ B) Edizione di ritorno</summary>
        <ul class="bullets">
          <li><span class="icon">â–¶ï¸</span><span class="li-text">Inizia alla <strong class="nowrap">21Âª giornata di Serie A</strong>.</span></li>
          <li><span class="icon">ğŸ“Š</span> Stesso sistema di punteggio dellâ€™edizione dâ€™andata.</li>
          <li><span class="icon">ğŸ</span> Termina obbligatoriamente alla <strong>38Âª giornata</strong>.</li>
          <li><span class="icon">ğŸ†</span> Vince il giocatore con il punteggio piÃ¹ alto tra gli ultimi superstiti (in caso di eliminazione collettiva prevale chi ha totalizzato piÃ¹ punti complessivi fino a quel momento).</li>
        </ul>
      </details>

      <details>
        <summary>â–¶ï¸ Spareggio (solo ritorno): vite potenziali</summary>
        <p>
          In caso di paritÃ  di punti totali al termine del girone di ritorno (38Âª giornata), vince il concorrente con piÃ¹
          <strong>vite potenzialmente disponibili</strong>, anche se non acquistate.
        </p>
        <p><strong>Esempio:</strong></p>
        <ul class="bullets">
          <li><span class="icon">ğŸ‘¤</span> Marco: acquista 5 vite e ne perde 4 â†’ 1 vita disponibile.</li>
          <li><span class="icon">ğŸ‘¤</span> Sofia: acquista 3 vite, le perde tutte e poi acquista 1 vita (4 in totale) â†’ le restano 2 vite disponibili.</li>
        </ul>
        <p class="note">
          ğŸ‘‰ Vince Sofia perchÃ© ha un margine teorico di vite maggiore rispetto al limite massimo di 5. Questa regola si applica anche a tutte le altre posizioni a premio e ai premi progressivi, in caso di paritÃ .
        </p>
      </details>

      <!-- ART. 3 -->
      <h2 id="art3">Art. 3 â€” â¤ï¸ Le vite</h2>
      <ul class="bullets">
        <li><span class="icon">ğŸŸï¸</span> Ogni giocatore puÃ² iniziare con 1, 3 o 5 vite.</li>
        <li><span class="icon">1ï¸âƒ£</span> Ogni giornata si gioca una sola vita.</li>
        <li><span class="icon">âœ…</span> Se la squadra scelta vince, la vita prosegue.</li>
        <li><span class="icon">âŒ</span> Se pareggia o perde, la vita Ã¨ persa definitivamente.</li>
        <li><span class="icon">ğŸšª</span> Quando un concorrente perde tutte le vite, Ã¨ eliminato.</li>
        <li><span class="icon">ğŸ”</span> Ãˆ possibile rientrare acquistando nuove vite, fino a un massimo di 5 vite totali per edizione.</li>
        <li><span class="icon">â±ï¸</span> Le vite riacquistate possono essere acquistate esclusivamente prima del turno successivo allâ€™eliminazione. Dopo lâ€™inizio della nuova giornata, il rientro non Ã¨ piÃ¹ consentito.</li>
      </ul>

      <!-- ART. 4 -->
      <h2 id="art4">Art. 4 â€” ğŸ’¸ Quote di iscrizione e rientri</h2>
      <div class="table-wrap" role="region" aria-label="Quote e pacchetti" tabindex="0">
        <table>
          <thead>
            <tr>
              <th>Pacchetto</th>
              <th>Costo</th>
              <th>Vite iniziali</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>1 Vita</td><td>10â‚¬</td><td>1</td></tr>
            <tr><td>3 Vite</td><td>20â‚¬</td><td>3</td></tr>
            <tr><td>5 Vite</td><td>30â‚¬</td><td>5</td></tr>
          </tbody>
        </table>
      </div>

      <p class="note">
        <strong>Rientri:</strong> 10â‚¬ per ogni nuova vita, fino al massimo di 5 totali.<br>
        <strong>Pagamento:</strong> PayPal con causale:
        <span class="kbd">[Nome squadra] â€“ Iscrizione Survivor Train</span>
        oppure
        <span class="kbd">[Nome squadra] â€“ NÂ° Vite</span><br>
        Link: <span class="kbd">https://www.paypal.me/SurvivorTrain</span>
      </p>

      <!-- ART. 5 -->
      <h2 id="art5">Art. 5 â€” ğŸ Bonus Inviti â€“ Vita Extra</h2>
      <p>
        Ãˆ previsto un bonus per chi contribuisce alla crescita della community:
        ogni giocatore che porta <strong>5 nuovi partecipanti iscritti</strong> allâ€™edizione ottiene 1 vita extra gratuita sul proprio pacchetto iniziale.
      </p>

      <details>
        <summary>â–¶ï¸ Dettagli bonus inviti</summary>
        <ol class="ordered">
          <li>I 5 partecipanti invitati devono indicare nella causale PayPal:
            <span class="kbd">[Nome squadra] â€“ Iscrizione Survivor Train - invitato da [Nome squadra invitante]</span>
          </li>
          <li>Tutti i pagamenti devono essere completati prima dellâ€™inizio della competizione.</li>
          <li>Il bonus viene caricato esclusivamente allâ€™inizio dellâ€™edizione, non durante lo svolgimento.</li>
          <li>Anche con la vita bonus, non Ã¨ possibile superare il limite massimo di 5 vite totali per edizione.</li>
        </ol>
        <p class="note">
          â— Il bonus inviti non Ã¨ cumulabile: anche portando 10, 15 o piÃ¹ persone â†’ massimo 1 vita bonus.
        </p>
      </details>

      <!-- ART. 6 -->
      <h2 id="art6">Art. 6 â€” ğŸ§  ModalitÃ  di gioco</h2>
      <p>
        Ogni concorrente deve pronosticare una sola squadra vincente per giornata, entro 15 minuti prima dellâ€™inizio della giornata di Serie A.
      </p>
      <ul class="bullets">
        <li><span class="icon">ğŸš«</span> Non si puÃ² puntare due volte sulla stessa squadra nella stessa edizione, salvo che tutte le altre squadre siano giÃ  state utilizzate dallâ€™utente.</li>
      </ul>

      <!-- ART. 7 -->
      <h2 id="art7">Art. 7 â€” ğŸ• Scadenze e giocate automatiche</h2>
      <ul class="bullets">
        <li><span class="icon">ğŸ¤–</span> Se un concorrente non effettua la giocata entro il limite stabilito, il sistema giocherÃ  automaticamente la prima squadra disponibile in ordine alfabetico.</li>
      </ul>

      <!-- ART. 8 -->
      <h2 id="art8">Art. 8 â€” âš½ Esiti delle partite</h2>
      <ul class="bullets">
        <li><span class="icon">âœ…</span> Se la squadra scelta vince, la vita Ã¨ salvata.</li>
        <li><span class="icon">âŒ</span> Se pareggia o perde, la vita Ã¨ persa definitivamente.</li>
        <li><span class="icon">ğŸ”</span> In caso di rinvii o sospensioni si applicano le regole del punto successivo.</li>
      </ul>

      <!-- ART. 9 -->
      <h2 id="art9">Art. 9 â€” ğŸ” Partite rinviate o sospese</h2>
      <details>
        <summary>â–¶ï¸ Regole per rinvii e recuperi</summary>
        <ul class="bullets">
          <li><span class="icon">â†©ï¸</span> Se non viene recuperato entro la giornata successiva â†’ giocate annullate e rifacibili.</li>
          <li><span class="icon">âœ…</span> Se viene recuperato entro tale termine â†’ giocate valide.</li>
        </ul>
      </details>

      

      <!-- ART. 10 -->
      <h2 id="art10">Art. 10 â€” ğŸ§© Classifica ufficiale</h2>
      <p>
        Alla fine di ogni giornata di Serie A verrÃ  aggiornata la Classifica con:
        <strong>Nome squadra</strong>, <strong>Vite Utilizzate</strong>, <strong>Punti totali</strong>.
      </p>
      <p class="note">

        La classifica verrÃ  aggiornata e pubblicata nella sezione dedicata del sito.
      </p>

      <!-- ART. 11 -->
      <h2 id="art11">Art. 11 â€” ğŸ’° Montepremi garantito e premi speciali</h2>
      <p>Il montepremi cresce con il numero dei partecipanti e viene distribuito ai migliori classificati e ai traguardi punti secondo i criteri seguenti.</p>

      <div class="table-wrap" role="region" aria-label="Montepremi garantito" tabindex="0">
        <table class="table-prizes">
          <thead>
            <tr>
              <th>Partecipanti</th>
              <th>Montepremi garantito</th>
              <th>Premi</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>50 â€“ 74</td>
              <td>1.500â‚¬</td>
              <td>
                <div class="prize-stack">
                  <div>ğŸ¥‡ 700â‚¬</div>
                  <div>ğŸ¥ˆ 400â‚¬</div>
                  <div>ğŸ¥‰ 200â‚¬</div>
                  <div>4Â° 120â‚¬</div>
                  <div>5Â° 80â‚¬</div>
                </div>
              </td>
            </tr>
            <tr>
              <td>75 â€“ 99</td>
              <td>2.000â‚¬</td>
              <td>
                <div class="prize-stack">
                  <div>ğŸ¥‡ 900â‚¬</div>
                  <div>ğŸ¥ˆ 500â‚¬</div>
                  <div>ğŸ¥‰ 300â‚¬</div>
                  <div>4Â° 180â‚¬</div>
                  <div>5Â° 120â‚¬</div>
                </div>
              </td>
            </tr>
            <tr>
              <td>100 â€“ 124</td>
              <td>2.500â‚¬</td>
              <td>
                <div class="prize-stack">
                  <div>ğŸ¥‡ 1.100â‚¬</div>
                  <div>ğŸ¥ˆ 600â‚¬</div>
                  <div>ğŸ¥‰ 400â‚¬</div>
                  <div>4Â° 250â‚¬</div>
                  <div>5Â° 150â‚¬</div>
                </div>
              </td>
            </tr>
            <tr>
              <td>125 â€“ 150</td>
              <td>3.000â‚¬</td>
              <td>
                <div class="prize-stack">
                  <div>ğŸ¥‡ 1.300â‚¬</div>
                  <div>ğŸ¥ˆ 700â‚¬</div>
                  <div>ğŸ¥‰ 500â‚¬</div>
                  <div>4Â° 300â‚¬</div>
                  <div>5Â° 200â‚¬</div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <details>
        <summary>â–¶ï¸ Premio fedeltÃ  (6Â°â€“10Â°)</summary>
        <p>
          I concorrenti dal 6Â° al 10Â° posto ricevono lâ€™iscrizione gratuita alla prossima edizione (pacchetto base da 1 vita).
        </p>
        <p class="note">
          ğŸ‘‰ In caso di paritÃ  di punteggio, il premio fedeltÃ  va a chi ha piÃ¹ vite disponibili; in ulteriore paritÃ , a chi ha partecipato a piÃ¹ giornate.
        </p>
      </details>

      <details>
        <summary>â–¶ï¸ Premi progressivi (soglie punti)</summary>
        <div class="table-wrap" role="region" aria-label="Premi progressivi" tabindex="0">
          <table>
            <thead>
              <tr>
                <th>Punti</th>
                <th>Premio</th>
                <th>Regola</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>100 punti</td><td>10â‚¬</td><td>al primo che supera la soglia</td></tr>
              <tr><td>200 punti</td><td>20â‚¬</td><td>al primo che supera la soglia</td></tr>
              <tr><td>300 punti</td><td>30â‚¬</td><td>al primo che supera la soglia</td></tr>
              <tr><td>400 punti</td><td>40â‚¬</td><td>al primo che supera la soglia</td></tr>
              <tr><td>500 punti</td><td>50â‚¬</td><td>al primo che supera la soglia</td></tr>
            </tbody>
          </table>
        </div>

        <p class="note">
          ğŸ’¡ In caso di superamento simultaneo della stessa soglia: il premio va a chi totalizza piÃ¹ punti oltre la soglia.
          In caso di ulteriore paritÃ , il premio viene suddiviso equamente tra i giocatori, a prescindere dal numero di vite ancora disponibili.
        </p>
      </details>

      <!-- ART. 12 -->
      <h2 id="art12">Art. 12 â€” ğŸ§­ Spirito del gioco</h2>
      <p>
        Lo Skillboll Survivor Train Ã¨ una corsa di intuizione, strategia e resistenza. Ogni giornata Ã¨ una fermata. Ogni vita, un biglietto.
      </p>
      <p>
        Solo chi gioca con intelligenza e sangue freddo arriverÃ  fino alla fine del viaggio.
      </p>
      <p><strong>â€œChi sbaglia scende. Chi resiste, arriva alla gloria.â€</strong> ğŸš†ğŸ”¥</p>

      <!-- ART. 13 -->
      <h2 id="art13">Art. 13 â€” ğŸ“¢ Comunicazioni ufficiali</h2>
      <p>
         Aggiornamenti e comunicazioni verranno pubblicati esclusivamente sui canali ufficiali:
        <a class="link" href="https://chat.whatsapp.com/IvyTjZsgfjaF3rpfs726BS?mode=wwt" target="_blank" rel="noopener noreferrer">
          WhatsApp â€“ Skillboll Survivor Train
        </a>
      </p>

      <!-- ART. 14 -->
      <h2 id="art14">Art. 14 â€” âš–ï¸ Amministrazione e Referee</h2>
      <p>
        La gestione tecnica e decisionale della competizione Ã¨ affidata allo Staff Ufficiale Skillboll Survivor Train, che svolge funzione di referee.
        Lo Staff ha il compito di:
      </p>
      <ul class="bullets">
        <li><span class="icon">âœ…</span> verificare pagamenti e iscrizioni</li>
        <li><span class="icon">âœ…</span> applicare il regolamento</li>
        <li><span class="icon">âœ…</span> risolvere controversie</li>
        <li><span class="icon">âœ…</span> convalidare risultati e rinvii</li>
        <li><span class="icon">âœ…</span> assegnare premi e bonus</li>
        <li><span class="icon">âœ…</span> gestire eventuali casi limite o non previsti</li>
      </ul>
      <p class="note"><strong>Tutte le decisioni dello Staff sono definitive e insindacabili.</strong></p>

      <h3>ğŸ“œ Credits ufficiali</h3>
      <p class="note">
        Documento redatto e approvato dallo Staff Ufficiale â€” Skillboll Survivor Train (Stagione 2025/2026) Â© 2025 â€” Tutti i diritti riservati.
      </p>

      <h3>âœ‰ï¸ Contatti</h3>
      <p class="note">Per informazioni o assistenza: <strong>survivortrainservice@gmail.com</strong></p>

      <div class="btn-row">
        <a class="btn" href="#top">Torna su</a>
      </div>

      <footer class="footer">
        <span>Â© 2025â€“2026 Survivor Train</span>
      </footer>
    </section>

    <section class="section" id="classifica-page">
      <h1 id="classifica-title">ğŸ Classifica ufficiale</h1>
      <p class="note sr-only" aria-hidden="true">
        Aggiornata: <span id="lb-updated">â€”</span>
        <span class="lb-status" id="lb-status" aria-live="polite"></span>
      </p>

      <div class="table-wrap" role="region" aria-label="Classifica ufficiale" tabindex="0">
        <table id="lb-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Squadra</th>
              <th>VITE UTILIZZATE</th>
              <th>Punti</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="4">Caricamentoâ€¦</td></tr>
          </tbody>
        </table>
      </div>

      <p class="note">Le squadre contrassegnate con le âŒ non hanno piÃ¹ diritto a riacquistare nuove vite.</p>

      <div class="btn-row">
        <a class="btn" href="./" id="back-regolamento">Torna al regolamento</a>
      </div>

      <footer class="footer">
        <span>Â© 2025â€“2026 Survivor Train</span>
      </footer>
    </section>
  </main>
  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const view = (params.get("view") || "").toLowerCase();
      const isAndata = view === "andata";
      const isRitorno = view === "ritorno";
      const isClassifica = isAndata || isRitorno;

      document.body.classList.toggle("view-classifica", isClassifica);

      // Active state on topbar buttons
      const btnReg = document.getElementById("nav-regolamento");
      const btnAnd = document.getElementById("nav-andata");
      const btnRit = document.getElementById("nav-ritorno");
      if (btnReg) btnReg.classList.toggle("is-active", !isClassifica);
      if (btnAnd) btnAnd.classList.toggle("is-active", isAndata);
      if (btnRit) btnRit.classList.toggle("is-active", isRitorno);

      // Update title for dedicated view
      const h1 = document.getElementById("classifica-title");
      if (isAndata) {
        document.title = "Classifica Andata â€” Skillboll Survivor Train";
        if (h1) h1.textContent = "ğŸ Classifica Edizione Andata";
      } else if (isRitorno) {
        document.title = "Classifica Ritorno â€” Skillboll Survivor Train";
        if (h1) h1.textContent = "ğŸ Classifica Edizione Ritorno";
      }
    })();
  </script>
  <script>
    const SHEET_CSV_URL_ANDATA = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQv_fr_5DZIalplAaWqN2KM5FBHIpClJvj5um0DN4mp7NunrKAkckAtX1w6SSMwORSz9xujVHx2a5TY/pub?gid=0&single=true&output=csv";
    const SHEET_CSV_URL_RITORNO = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkvkegclAzBBCmAqh8LMofGGOFyrd6-GmPUCbVMBL1v2FBUoJdbAm8NKibi3sfMsC3PWwiShkLnVz4/pub?gid=0&single=true&output=csv";

    const REFRESH_MS = 60_000;

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function formatPoints(v) {
      const n = Number(String(v).replace(",", "."));
      if (Number.isNaN(n)) return "0";
      const oneDec = Math.round(n * 10) / 10;
      return String(oneDec).replace(".", ",");
    }

    function parseCSV(text) {
      // CSV parser robusto per campi con virgole/virgolette
      const rows = [];
      let row = [];
      let cur = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        const next = text[i + 1];

        if (inQuotes) {
          if (ch === '"' && next === '"') {
            cur += '"';
            i++;
          } else if (ch === '"') {
            inQuotes = false;
          } else {
            cur += ch;
          }
        } else {
          if (ch === '"') {
            inQuotes = true;
          } else if (ch === ',') {
            row.push(cur);
            cur = "";
          } else if (ch === '\n') {
            row.push(cur);
            rows.push(row);
            row = [];
            cur = "";
          } else if (ch === '\r') {
            // ignore
          } else {
            cur += ch;
          }
        }
      }
      // last cell
      row.push(cur);
      rows.push(row);
      return rows.filter(r => r.some(cell => String(cell).trim() !== ""));
    }

    function buildFromRows(csvRows) {
      // Intestazioni attese: team, lives, points (accettiamo varianti IT)
      const header = (csvRows[0] || []).map(h => String(h).trim().toLowerCase());
      const teamIdx = header.findIndex(h => ["team", "squadra", "nome squadra", "nome_squadra"].includes(h));
      const livesIdx = header.findIndex(h => ["lives", "vite", "vite rimaste", "vite_rimaste"].includes(h));
      const pointsIdx = header.findIndex(h => ["points", "punti", "punteggio", "punti totali", "punti_totali"].includes(h));

      if (teamIdx === -1 || livesIdx === -1 || pointsIdx === -1) {
        throw new Error("Header CSV non riconosciuto. Servono colonne: team/squadra, lives/vite, points/punti.");
      }

      const items = csvRows.slice(1).map(r => ({
        team: (r[teamIdx] ?? "").toString().trim(),
        lives: Number(String(r[livesIdx] ?? "0").trim()),
        points: Number(String(r[pointsIdx] ?? "0").trim().replace(",", "."))
      })).filter(x => x.team.length > 0);

      // Ordina per punti desc, poi vite desc, poi nome
      items.sort((a, b) => {
        const dp = (b.points || 0) - (a.points || 0);
        if (dp !== 0) return dp;
        const dl = (b.lives || 0) - (a.lives || 0);
        if (dl !== 0) return dl;
        return a.team.localeCompare(b.team, "it");
      });

      return items;
    }

    async function loadLeaderboard() {
      const tbody = document.querySelector("#lb-table tbody");
      const updatedEl = document.getElementById("lb-updated");
      const statusEl = document.getElementById("lb-status");

      const params = new URLSearchParams(window.location.search);
      const view = (params.get("view") || "").toLowerCase();
      const isAndata = view === "andata";
      const isRitorno = view === "ritorno";

      const activeUrl = isRitorno ? SHEET_CSV_URL_RITORNO : SHEET_CSV_URL_ANDATA;

      if (!activeUrl || activeUrl.includes("PASTE_RITORNO_CSV_URL_HERE") || activeUrl.includes("PASTE_YOUR_PUBLISHED_CSV_URL_HERE")) {
        updatedEl.textContent = "Imposta URL CSV";
        tbody.innerHTML = '<tr><td colspan="4"></td></tr>';
        return;
      }

      statusEl.textContent = "";

      try {
        const url = `${activeUrl}${activeUrl.includes("?") ? "&" : "?"}v=${Date.now()}`;
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const text = await res.text();

        const csvRows = parseCSV(text);
        const items = buildFromRows(csvRows);

        tbody.innerHTML = "";
        if (items.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4">Nessun dato in classifica.</td></tr>';
        } else {
          items.forEach((r, i) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${i + 1}</td>
              <td>${escapeHtml(r.team)}</td>
              <td>${Number.isFinite(r.lives) ? r.lives : 0}</td>
              <td>${formatPoints(r.points)}</td>
            `;
            tbody.appendChild(tr);
          });
        }

        const now = new Date();
        updatedEl.textContent = now.toLocaleString("it-IT", { dateStyle: "short", timeStyle: "short" });
      } catch (err) {
        updatedEl.textContent = "Errore";
        statusEl.textContent = " â€” impossibile aggiornare";
        tbody.innerHTML = `<tr><td colspan="4">âŒ Errore caricamento: ${escapeHtml(err.message || err)}</td></tr>`;
      }
    }

    loadLeaderboard();
    setInterval(loadLeaderboard, REFRESH_MS);
  </script>
  <script>
    (function () {
      const topbar = document.querySelector('.topbar');
      if (!topbar) return;

      let lastY = window.scrollY || 0;
      let ticking = false;

      function isMobile() {
        return window.matchMedia('(max-width: 600px)').matches;
      }

      function update() {
        ticking = false;
        if (!isMobile()) {
          topbar.classList.remove('topbar-hidden');
          lastY = window.scrollY || 0;
          return;
        }

        const y = window.scrollY || 0;
        const goingDown = y > lastY;

        // Hide only after a small offset so it doesn't flicker near the top
        if (goingDown && y > 80) {
          topbar.classList.add('topbar-hidden');
        } else {
          topbar.classList.remove('topbar-hidden');
        }

        lastY = y;
      }

      function onScroll() {
        if (!ticking) {
          ticking = true;
          window.requestAnimationFrame(update);
        }
      }

      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('resize', update, { passive: true });

      // initial
      update();
    })();
  </script>
</body>
</html>